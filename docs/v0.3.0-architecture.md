# EchoType v0.3.0 â€” å®Œæ•´æ¶æ§‹è¦åŠƒæ›¸

> åŸºæ–¼ Typeless é€†å‘å·¥ç¨‹ã€macOS éµç›¤äº‹ä»¶ç ”ç©¶ã€æ¬Šé™æµç¨‹åˆ†æã€å‰ç«¯é–‹æºæ–¹æ¡ˆè©•ä¼°
> æ—¥æœŸ: 2026-02-19

---

## ä¸€ã€ç‰ˆæœ¬ç›®æ¨™èˆ‡ç¯„åœ

v0.3.0 èšç„¦ä¸‰å¤§æ ¸å¿ƒæ”¹é€²ï¼š

| å„ªå…ˆç´š | é …ç›® | ç¾ç‹€ | ç›®æ¨™ |
|--------|------|------|------|
| P0 | fn éµ CGEventTap é•·æŒ‰/é»æŒ‰éŒ„éŸ³ | F13 global-shortcutï¼ˆç„¡é•·æŒ‰ï¼‰ | CGEventTap ç‹€æ…‹æ©Ÿï¼Œæ”¯æ´ push-to-talk + toggle |
| P0 | Onboarding æ¬Šé™è«‹æ±‚æµç¨‹ | Step 3 æ˜¯ç©ºæ®¼ | å®Œæ•´çš„åˆ†å±¤æ¬Šé™å¼•å° + è¼ªè©¢åµæ¸¬ |
| P0 | è¨­å®šé é¢æ»¾å‹•æº¢å‡ºä¿®å¾© | å…§å®¹è¶…å‡ºè¦–çª—ç„¡æ³•æ»¾å‹• | æ­£ç¢ºçš„ overflow-y scroll ä½ˆå±€ |
| P1 | æ¬Šé™ç‹€æ…‹å„€è¡¨æ¿ | ç„¡ | è¨­å®šé é¢å³æ™‚é¡¯ç¤ºå„æ¬Šé™ç‹€æ…‹ |
| P1 | å¿«æ·éµæ¨¡å¼åˆ‡æ› UI | ç„¡ | é•·æŒ‰/é»æŒ‰æ¨¡å¼é¸æ“‡ |
| P2 | Accessibility è¼ªè©¢å®ˆè­· | ç„¡ | æ¯ 2 ç§’è¼ªè©¢ + è‡ªå‹•æ¢å¾© |

---

## äºŒã€ç³»çµ±æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EchoType v0.3.0                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Tauri Events    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Rust Core  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   React Frontend     â”‚    â”‚
â”‚  â”‚             â”‚   invoke/emit     â”‚                      â”‚    â”‚
â”‚  â”‚ keyboard.rs â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ FloatingBar.tsx      â”‚    â”‚
â”‚  â”‚  (CGEventTapâ”‚   hotkey-pressed  â”‚ Onboarding.tsx       â”‚    â”‚
â”‚  â”‚   fn ç‹€æ…‹æ©Ÿ) â”‚   hotkey-released â”‚ Settings.tsx         â”‚    â”‚
â”‚  â”‚             â”‚   hotkey-tap      â”‚ Hub.tsx              â”‚    â”‚
â”‚  â”‚ commands.rs â”‚   hotkey-cancelledâ”‚                      â”‚    â”‚
â”‚  â”‚ bridge.rs   â”‚                   â”‚ lib/permissions.ts   â”‚    â”‚
â”‚  â”‚ tray.rs     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ lib/hotkey-config.ts â”‚    â”‚
â”‚  â”‚ permissions â”‚   check_perms     â”‚                      â”‚    â”‚
â”‚  â”‚   .rs (æ–°å¢) â”‚   open_sys_prefs  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚         â”‚ JSON stdin/stdout                                     â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Swift Helperâ”‚                                                â”‚
â”‚  â”‚ (CoreKit)   â”‚                                                â”‚
â”‚  â”‚ AudioManagerâ”‚                                                â”‚
â”‚  â”‚ ASR Engine  â”‚                                                â”‚
â”‚  â”‚ TextInjectorâ”‚                                                â”‚
â”‚  â”‚ ContextRead â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Rust å¾Œç«¯æ”¹é€ 

### 3.1 æ–°å¢ `permissions.rs` â€” æ¬Šé™ç®¡ç†æ¨¡çµ„

è·è²¬ï¼šé›†ä¸­ç®¡ç† macOS ä¸‰å¤§æ¬Šé™çš„æª¢æ¸¬ã€å¼•å°ã€è¼ªè©¢ã€‚

```rust
// desktop/src-tauri/src/permissions.rs

use serde::Serialize;
use std::ffi::c_void;
use std::process::Command;

#[derive(Debug, Clone, Serialize)]
pub struct PermissionStatus {
    pub microphone: String,       // "not_determined" | "authorized" | "denied"
    pub accessibility: bool,      // AXIsProcessTrusted
    pub input_monitoring: bool,   // CGEventTap å¯å»ºç«‹
}

// === Accessibility ===
extern "C" {
    fn AXIsProcessTrusted() -> bool;
    fn AXIsProcessTrustedWithOptions(options: *const c_void) -> bool;
}

pub fn check_accessibility() -> bool {
    unsafe { AXIsProcessTrusted() }
}

// === Input Monitoring (é–“æ¥åµæ¸¬) ===
// å˜—è©¦å»ºç«‹ CGEventTapï¼ŒæˆåŠŸ = æœ‰æ¬Šé™
pub fn check_input_monitoring() -> bool {
    // é€é core-graphics FFI å˜—è©¦å»ºç«‹ ListenOnly tap
    // æˆåŠŸå¾Œç«‹å³éŠ·æ¯€ï¼Œåƒ…ç”¨æ–¼åµæ¸¬
    unsafe {
        let tap = CGEventTapCreate(
            1,  // kCGSessionEventTap
            0,  // kCGHeadInsertEventTap
            1,  // kCGEventTapOptionListenOnly
            (1u64 << 12),  // CGEventMaskBit(kCGEventFlagsChanged)
            probe_callback,
            std::ptr::null_mut(),
        );
        if tap.is_null() { return false; }
        CFRelease(tap as *const c_void);
        true
    }
}

// === Microphone (é€é helper æª¢æ¸¬) ===
// macOS TCC æ¬Šé™éœ€åœ¨æœ‰ AVFoundation çš„é€²ç¨‹ä¸­æª¢æ¸¬
// ç”± Swift helper å›å ±

// === Deep Links ===
pub fn open_system_preferences(pane: &str) -> Result<(), String> {
    let url = match pane {
        "microphone" =>
            "x-apple.systempreferences:com.apple.preference.security?Privacy_Microphone",
        "accessibility" =>
            "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility",
        "input_monitoring" =>
            "x-apple.systempreferences:com.apple.preference.security?Privacy_ListenEvent",
        _ => return Err(format!("Unknown pane: {pane}")),
    };
    Command::new("open").arg(url).spawn().map_err(|e| e.to_string())?;
    Ok(())
}
```

Tauri Commands æ–°å¢ï¼š

```rust
// commands.rs æ–°å¢

#[tauri::command]
pub fn check_permissions() -> PermissionStatus {
    PermissionStatus {
        microphone: check_microphone_via_helper(),  // é€é bridge å‘¼å« helper
        accessibility: permissions::check_accessibility(),
        input_monitoring: permissions::check_input_monitoring(),
    }
}

#[tauri::command]
pub fn open_system_preferences(pane: String) -> Result<(), String> {
    permissions::open_system_preferences(&pane)
}

#[tauri::command]
pub fn request_microphone() -> Result<String, String> {
    // é€é bridge å‘¼å« helper çš„ AVCaptureDevice.requestAccess
    bridge::call_helper_sync("request_microphone", json!({}))
        .map(|v| v.to_string())
}
```

### 3.2 æ”¹é€  `keyboard.rs` â€” CGEventTap fn éµç‹€æ…‹æ©Ÿ

ç¾ç‹€å•é¡Œï¼š
- ä½¿ç”¨ `tauri_plugin_global_shortcut` ç¶å®š F13
- ä¸æ”¯æ´ fn/Globe éµï¼ˆmodifier key ä¸ç”¢ç”Ÿ keyDown/keyUpï¼‰
- ç„¡é•·æŒ‰ vs é»æŒ‰å€åˆ†

æ”¹é€ æ–¹æ¡ˆï¼šç§»é™¤ global-shortcut ä¾è³´ï¼Œæ”¹ç”¨ CGEventTap ç›´æ¥ç›£è½ `kCGEventFlagsChanged`ã€‚

#### 3.2.1 ç‹€æ…‹æ©Ÿè¨­è¨ˆ

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                     â”‚
                    â–¼                                     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   fn down    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚   IDLE   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  PENDING     â”‚  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  (ç­‰å¾…åˆ¤å®š)   â”‚  â”‚
                    â–²                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                          â”‚          â”‚
                    â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚              â”‚           â”‚          â”‚
                    â”‚    fn up     â”‚  300ms    â”‚  å…¶ä»–éµ  â”‚
                    â”‚   < 300ms    â”‚  elapsed  â”‚  æŒ‰ä¸‹    â”‚
                    â”‚              â”‚           â”‚  (å–æ¶ˆ)  â”‚
                    â”‚              â–¼           â”‚          â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚          â”‚
                    â”‚    â”‚  TAP         â”‚      â”‚          â”‚
                    â”‚    â”‚  (toggle)    â”‚â”€â”€â”€â”€â”€â”€â”˜          â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                                     â”‚
                    â”‚         300ms timer fires            â”‚
                    â”‚              â”‚                       â”‚
                    â”‚              â–¼                       â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
                    â”‚    â”‚  HOLDING     â”‚                  â”‚
                    â”‚    â”‚  (éŒ„éŸ³ä¸­)    â”‚                  â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚           â”‚                          â”‚
                    â”‚      fn up                           â”‚
                    â”‚           â”‚                          â”‚
                    â”‚           â–¼                          â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
                    â””â”€â”€â”€â”€â”‚  RELEASED    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚  (åœæ­¢éŒ„éŸ³)  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å…©ç¨®éŒ„éŸ³æ¨¡å¼ï¼š
- **é•·æŒ‰æ¨¡å¼ (push-to-talk)**ï¼šæŒ‰ä½ fn > 300ms â†’ é–‹å§‹éŒ„éŸ³ â†’ æ”¾é–‹ â†’ åœæ­¢ä¸¦è½‰æ–‡å­—
- **é»æŒ‰æ¨¡å¼ (toggle)**ï¼šçŸ­æŒ‰ fn < 300ms â†’ é–‹å§‹/åœæ­¢éŒ„éŸ³åˆ‡æ›

#### 3.2.2 é—œéµå¸¸æ•¸

| å¸¸æ•¸ | å€¼ | èªªæ˜ |
|------|-----|------|
| `HOLD_THRESHOLD_MS` | 300 | é•·æŒ‰åˆ¤å®šé–¾å€¼ |
| `MIN_RECORDING_MS` | 500 | æœ€çŸ­æœ‰æ•ˆéŒ„éŸ³æ™‚é•· |
| `DEBOUNCE_MS` | 50 | flagsChanged å»æŠ–å‹• |
| `FN_FLAG_MASK` | 0x800000 | kCGEventFlagMaskSecondaryFn |
| `FLAGS_CHANGED` | 12 | kCGEventFlagsChanged äº‹ä»¶é¡å‹ |

#### 3.2.3 å®Œæ•´ Rust å¯¦ä½œ

```rust
// desktop/src-tauri/src/keyboard.rs (å®Œæ•´æ”¹é€ )

use std::ffi::c_void;
use std::sync::atomic::{AtomicBool, AtomicU64, Ordering};
use std::sync::Arc;
use std::time::{Duration, Instant};
use tauri::{AppHandle, Emitter};

// === CGEventTap FFI å®£å‘Š ===
type CGEventRef = *mut c_void;
type CGEventTapProxy = *mut c_void;
type CFMachPortRef = *mut c_void;
type CFRunLoopSourceRef = *mut c_void;
type CFRunLoopRef = *mut c_void;

const K_CG_SESSION_EVENT_TAP: u32 = 1;
const K_CG_HEAD_INSERT_EVENT_TAP: u32 = 0;
const K_CG_EVENT_TAP_OPTION_LISTEN_ONLY: u32 = 1;
const K_CG_EVENT_FLAGS_CHANGED: u32 = 12;
const FN_FLAG_MASK: u64 = 0x800000;
const HOLD_THRESHOLD_MS: u64 = 300;
const MIN_RECORDING_MS: u64 = 500;
const DEBOUNCE_MS: u64 = 50;

extern "C" {
    fn CGEventTapCreate(
        tap: u32, place: u32, options: u32,
        events_of_interest: u64,
        callback: extern "C" fn(CGEventTapProxy, u32, CGEventRef, *mut c_void) -> CGEventRef,
        user_info: *mut c_void,
    ) -> CFMachPortRef;
    fn CGEventGetFlags(event: CGEventRef) -> u64;
    fn CGEventTapEnable(tap: CFMachPortRef, enable: bool);
    fn CGEventTapIsEnabled(tap: CFMachPortRef) -> bool;
    fn CFMachPortCreateRunLoopSource(
        allocator: *const c_void, port: CFMachPortRef, order: i64,
    ) -> CFRunLoopSourceRef;
    fn CFRunLoopGetCurrent() -> CFRunLoopRef;
    fn CFRunLoopAddSource(rl: CFRunLoopRef, source: CFRunLoopSourceRef, mode: *const c_void);
    fn CFRunLoopRun();
    fn CFRelease(cf: *const c_void);
}

extern "C" {
    static kCFRunLoopCommonModes: *const c_void;
}

// === ç‹€æ…‹æ©Ÿ ===
#[derive(Debug, Clone, Copy, PartialEq)]
enum FnKeyState {
    Idle,
    Pending,   // fn æŒ‰ä¸‹ï¼Œç­‰å¾… 300ms åˆ¤å®š
    Holding,   // ç¢ºèªé•·æŒ‰ï¼ŒéŒ„éŸ³ä¸­
    Recording, // é»æŒ‰è§¸ç™¼çš„ toggle éŒ„éŸ³ä¸­
}

struct FnKeyContext {
    state: std::sync::Mutex<FnKeyState>,
    press_instant: std::sync::Mutex<Instant>,
    last_event_ms: AtomicU64,
    app_handle: AppHandle,
    tap_ref: std::sync::Mutex<Option<CFMachPortRef>>,
}

// å…¨åŸŸ context æŒ‡æ¨™ï¼ˆCGEventTap callback éœ€è¦ï¼‰
static mut GLOBAL_CTX: *const FnKeyContext = std::ptr::null();

extern "C" fn event_tap_callback(
    _proxy: CGEventTapProxy,
    event_type: u32,
    event: CGEventRef,
    _user_info: *mut c_void,
) -> CGEventRef {
    // CGEventTap è¢«ç³»çµ±åœç”¨æ™‚è‡ªå‹•é‡å•Ÿ
    if event_type == 0xFFFFFFFE {
        // kCGEventTapDisabledByTimeout
        unsafe {
            let ctx = &*GLOBAL_CTX;
            if let Some(tap) = ctx.tap_ref.lock().unwrap().as_ref() {
                CGEventTapEnable(*tap, true);
            }
        }
        return event;
    }

    if event_type != K_CG_EVENT_FLAGS_CHANGED {
        return event;
    }

    let flags = unsafe { CGEventGetFlags(event) };
    let fn_down = (flags & FN_FLAG_MASK) != 0;

    unsafe {
        let ctx = &*GLOBAL_CTX;

        // Debounce: å¿½ç•¥ 50ms å…§çš„é‡è¤‡äº‹ä»¶
        let now_ms = Instant::now()
            .duration_since(*ctx.press_instant.lock().unwrap())
            .as_millis() as u64;
        let last = ctx.last_event_ms.load(Ordering::Relaxed);
        if now_ms.saturating_sub(last) < DEBOUNCE_MS {
            return event;
        }
        ctx.last_event_ms.store(now_ms, Ordering::Relaxed);

        let mut state = ctx.state.lock().unwrap();

        match (*state, fn_down) {
            // === IDLE + fn æŒ‰ä¸‹ â†’ PENDING ===
            (FnKeyState::Idle, true) => {
                *ctx.press_instant.lock().unwrap() = Instant::now();
                *state = FnKeyState::Pending;

                // å•Ÿå‹• 300ms è¨ˆæ™‚å™¨ï¼ˆç¨ç«‹åŸ·è¡Œç·’ï¼‰
                let app = ctx.app_handle.clone();
                let state_ptr = GLOBAL_CTX;
                std::thread::spawn(move || {
                    std::thread::sleep(Duration::from_millis(HOLD_THRESHOLD_MS));
                    let ctx2 = &*state_ptr;
                    let mut s = ctx2.state.lock().unwrap();
                    if *s == FnKeyState::Pending {
                        *s = FnKeyState::Holding;
                        let _ = app.emit("hotkey-pressed", "fn-hold");
                    }
                });
            }

            // === PENDING + fn æ”¾é–‹ (< 300ms) â†’ TAP ===
            (FnKeyState::Pending, false) => {
                *state = FnKeyState::Idle;
                let _ = ctx.app_handle.emit("hotkey-tap", "fn-tap");
            }

            // === HOLDING + fn æ”¾é–‹ â†’ åœæ­¢éŒ„éŸ³ ===
            (FnKeyState::Holding, false) => {
                let elapsed = ctx.press_instant.lock().unwrap().elapsed();
                *state = FnKeyState::Idle;

                if elapsed.as_millis() >= MIN_RECORDING_MS as u128 {
                    let _ = ctx.app_handle.emit("hotkey-released", "fn-hold");
                } else {
                    let _ = ctx.app_handle.emit("hotkey-cancelled", "too-short");
                }
            }

            // === RECORDING (toggle æ¨¡å¼) + fn tap â†’ åœæ­¢ ===
            // é€™å€‹ç”±å‰ç«¯è™•ç†ï¼šæ”¶åˆ° hotkey-tap æ™‚åˆ¤æ–·ç•¶å‰æ˜¯å¦åœ¨éŒ„éŸ³

            _ => {}
        }
    }

    event
}

/// å•Ÿå‹• fn éµå…¨åŸŸç›£è½ï¼ˆåœ¨ç¨ç«‹åŸ·è¡Œç·’çš„ CFRunLoop ä¸­é‹è¡Œï¼‰
pub fn start_fn_key_listener(app: AppHandle) {
    std::thread::spawn(move || {
        let ctx = Box::new(FnKeyContext {
            state: std::sync::Mutex::new(FnKeyState::Idle),
            press_instant: std::sync::Mutex::new(Instant::now()),
            last_event_ms: AtomicU64::new(0),
            app_handle: app,
            tap_ref: std::sync::Mutex::new(None),
        });

        unsafe {
            GLOBAL_CTX = &*ctx as *const FnKeyContext;
        }

        let mask: u64 = 1 << K_CG_EVENT_FLAGS_CHANGED;

        let tap = unsafe {
            CGEventTapCreate(
                K_CG_SESSION_EVENT_TAP,
                K_CG_HEAD_INSERT_EVENT_TAP,
                K_CG_EVENT_TAP_OPTION_LISTEN_ONLY,
                mask,
                event_tap_callback,
                std::ptr::null_mut(),
            )
        };

        if tap.is_null() {
            eprintln!("[keyboard] CGEventTap å»ºç«‹å¤±æ•— â€” ç¼ºå°‘ Accessibility æ¬Šé™");
            return;
        }

        *ctx.tap_ref.lock().unwrap() = Some(tap);

        unsafe {
            let source = CFMachPortCreateRunLoopSource(
                std::ptr::null(), tap, 0,
            );
            let run_loop = CFRunLoopGetCurrent();
            CFRunLoopAddSource(run_loop, source, kCFRunLoopCommonModes);
            CGEventTapEnable(tap, true);

            // ä¸è¦ leak context
            std::mem::forget(ctx);

            CFRunLoopRun(); // é˜»å¡ï¼Œç›´åˆ°åŸ·è¡Œç·’çµæŸ
        }
    });
}
```

#### 3.2.4 Tauri äº‹ä»¶æ¸…å–®

| äº‹ä»¶åç¨± | Payload | è§¸ç™¼æ™‚æ©Ÿ | å‰ç«¯è¡Œç‚º |
|----------|---------|----------|----------|
| `hotkey-pressed` | `"fn-hold"` | fn æŒ‰ä½è¶…é 300ms | é–‹å§‹éŒ„éŸ³ |
| `hotkey-released` | `"fn-hold"` | fn æ”¾é–‹ï¼ˆé•·æŒ‰æ¨¡å¼ï¼‰ | åœæ­¢éŒ„éŸ³ + ASR |
| `hotkey-tap` | `"fn-tap"` | fn çŸ­æŒ‰ < 300ms | Toggle éŒ„éŸ³é–‹/é—œ |
| `hotkey-cancelled` | `"too-short"` | é•·æŒ‰ä½†éŒ„éŸ³ < 500ms | ä¸Ÿæ£„ï¼Œé¡¯ç¤ºæç¤º |

#### 3.2.5 lib.rs æ•´åˆè®Šæ›´

```rust
// lib.rs ä¿®æ”¹é‡é»

// ç§»é™¤: tauri_plugin_global_shortcut
// æ–°å¢: permissions æ¨¡çµ„

mod permissions;

pub fn run() {
    tauri::Builder::default()
        // ç§»é™¤ .plugin(tauri_plugin_global_shortcut::init())
        .plugin(tauri_plugin_shell::init())
        .plugin(tauri_plugin_dialog::init())
        .plugin(tauri_plugin_notification::init())
        .plugin(tauri_plugin_clipboard_manager::init())
        .plugin(tauri_plugin_autostart::init(
            tauri_plugin_autostart::MacosLauncher::LaunchAgent, None
        ))
        .invoke_handler(tauri::generate_handler![
            commands::get_context,
            commands::start_recording,
            commands::stop_recording,
            commands::inject_text,
            commands::get_history,
            commands::get_settings,
            commands::set_setting,
            commands::get_microphones,
            // v0.3.0 æ–°å¢
            commands::check_permissions,
            commands::open_system_preferences,
            commands::request_microphone,
        ])
        .setup(|app| {
            tray::setup_tray(app)?;

            // å•Ÿå‹• CGEventTap fn éµç›£è½ï¼ˆå–ä»£ global-shortcutï¼‰
            keyboard::start_fn_key_listener(app.handle().clone());

            // å»ºç«‹æµ®å‹•æ¢è¦–çª—
            // ...ï¼ˆç¾æœ‰é‚è¼¯ä¸è®Šï¼‰

            Ok(())
        })
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

#### 3.2.6 Cargo.toml è®Šæ›´

```toml
[dependencies]
# ç§»é™¤
# tauri-plugin-global-shortcut = "2"

# æ–°å¢ï¼ˆCGEventTap FFI æ‰€éœ€ï¼ŒTauri å·²é–“æ¥ä¾è³´ï¼Œé¡¯å¼è²æ˜ç‰ˆæœ¬ï¼‰
core-graphics = "0.24"
core-foundation = "0.10"
```

#### 3.2.7 é˜²èª¤è§¸ç­–ç•¥

1. **Debounce 50ms**ï¼šå¿½ç•¥ flagsChanged äº‹ä»¶æŠ–å‹•
2. **é•·æŒ‰é–¾å€¼ 300ms**ï¼šå¤ªçŸ­å®¹æ˜“èª¤è§¸ï¼Œå¤ªé•·é«”é©—é²éˆ
3. **æœ€çŸ­éŒ„éŸ³ 500ms**ï¼šéŒ„éŸ³å¤ªçŸ­ç›´æ¥ä¸Ÿæ£„
4. **çµ„åˆéµæ’é™¤**ï¼šfn + å…¶ä»–éµåŒæ™‚æŒ‰ä¸‹æ™‚ä¸è§¸ç™¼ï¼ˆæœªä¾†å¯æ“´å±• fn+Spaceã€fn+Shiftï¼‰
5. **CGEventTap è‡ªå‹•é‡å•Ÿ**ï¼šç³»çµ±åœç”¨æ™‚ï¼ˆcallback å¤ªæ…¢ï¼‰è‡ªå‹• re-enable

---

## å››ã€å‰ç«¯æ¶æ§‹æ”¹é€ 

### 4.1 è¨­å®šé é¢æ»¾å‹•æº¢å‡ºä¿®å¾© (P0)

å•é¡Œæ ¹å› ï¼šSettings.tsx çš„å®¹å™¨æ²’æœ‰è¨­å®š `overflow-y: auto` ä¸”é«˜åº¦æœªé™åˆ¶ç‚ºè¦–çª—é«˜åº¦ã€‚

ä¿®å¾©æ–¹æ¡ˆï¼š

```css
/* æ–°å¢è‡³ index.css æˆ–ç¨ç«‹ Settings.css */

.settings-page {
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

.settings-header {
  flex-shrink: 0;
  padding: 24px 32px 16px;
  border-bottom: 1px solid var(--color-border);
}

.settings-content {
  flex: 1;
  overflow-y: auto;
  padding: 24px 32px 48px;

  /* macOS é¢¨æ ¼æ»¾å‹•æ¢ */
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.15) transparent;
}

.settings-content::-webkit-scrollbar {
  width: 6px;
}

.settings-content::-webkit-scrollbar-track {
  background: transparent;
}

.settings-content::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.15);
  border-radius: 3px;
}

.settings-content::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.25);
}
```

Settings.tsx çµæ§‹èª¿æ•´ï¼š

```tsx
// Settings.tsx çµæ§‹æ”¹é€ 

export default function Settings() {
  return (
    <div className="settings-page">
      {/* å›ºå®šé ‚éƒ¨ */}
      <div className="settings-header">
        <button onClick={() => navigate("/")} className="btn btn-ghost">
          â† è¿”å›
        </button>
        <h1>è¨­å®š</h1>
      </div>

      {/* å¯æ»¾å‹•å…§å®¹å€ */}
      <div className="settings-content">
        <SettingsSection title="èªéŸ³è¾¨è­˜å¼•æ“">...</SettingsSection>
        <SettingsSection title="è¼¸å…¥è£ç½®">...</SettingsSection>
        <SettingsSection title="AI æ½¤é£¾">...</SettingsSection>
        <SettingsSection title="èªè¨€è¨­å®š">...</SettingsSection>
        <SettingsSection title="å¿«æ·éµ">...</SettingsSection>        {/* v0.3.0 æ–°å¢ */}
        <SettingsSection title="æ¬Šé™ç‹€æ…‹">...</SettingsSection>      {/* v0.3.0 æ–°å¢ */}
        <SettingsSection title="ç³»çµ±æ•´åˆ">...</SettingsSection>
        <SettingsSection title="éš±ç§èˆ‡å„²å­˜">...</SettingsSection>
      </div>
    </div>
  );
}
```

### 4.2 æ–°å¢ `lib/permissions.ts` â€” å‰ç«¯æ¬Šé™ç®¡ç†

```typescript
// src/lib/permissions.ts

import { invoke } from "@tauri-apps/api/core";

export interface PermissionStatus {
  microphone: "not_determined" | "authorized" | "denied";
  accessibility: boolean;
  input_monitoring: boolean;
}

/** ä¸€æ¬¡æ€§æª¢æŸ¥æ‰€æœ‰æ¬Šé™ */
export async function checkAllPermissions(): Promise<PermissionStatus> {
  return await invoke("check_permissions");
}

/** æ‰“é–‹ç³»çµ±åå¥½è¨­å®šå°æ‡‰é¢æ¿ */
export async function openSystemPreferences(
  pane: "microphone" | "accessibility" | "input_monitoring"
): Promise<void> {
  await invoke("open_system_preferences", { pane });
}

/** è«‹æ±‚éº¥å…‹é¢¨æ¬Šé™ï¼ˆè§¸ç™¼ç³»çµ±å°è©±æ¡†ï¼‰ */
export async function requestMicrophone(): Promise<string> {
  return await invoke("request_microphone");
}

/**
 * è¼ªè©¢æ¬Šé™ç‹€æ…‹ï¼ˆç”¨æ–¼ Accessibility ç­‰éœ€æ‰‹å‹•é–‹å•Ÿçš„æ¬Šé™ï¼‰
 * è¿”å› cleanup å‡½æ•¸
 */
export function pollPermission(
  checkFn: () => Promise<boolean>,
  onGranted: () => void,
  intervalMs: number = 2000
): () => void {
  const timer = setInterval(async () => {
    try {
      const granted = await checkFn();
      if (granted) {
        clearInterval(timer);
        onGranted();
      }
    } catch {
      // å¿½ç•¥æª¢æ¸¬éŒ¯èª¤
    }
  }, intervalMs);
  return () => clearInterval(timer);
}

/**
 * React Hook: æŒçºŒç›£æ§æ¬Šé™ç‹€æ…‹
 */
export function usePermissions() {
  const [status, setStatus] = useState<PermissionStatus | null>(null);
  const [loading, setLoading] = useState(true);

  const refresh = useCallback(async () => {
    const s = await checkAllPermissions();
    setStatus(s);
    setLoading(false);
  }, []);

  useEffect(() => {
    refresh();
    // æ¯ 3 ç§’åˆ·æ–°ï¼ˆAccessibility å¯èƒ½è¢«æ‰‹å‹•é–‹å•Ÿï¼‰
    const timer = setInterval(refresh, 3000);
    return () => clearInterval(timer);
  }, [refresh]);

  return { status, loading, refresh };
}
```

### 4.3 æ–°å¢ `lib/hotkey-config.ts` â€” å¿«æ·éµé…ç½®

```typescript
// src/lib/hotkey-config.ts

export type HotkeyMode = "push_to_talk" | "toggle";

export interface HotkeyConfig {
  mode: HotkeyMode;
  triggerKey: string; // "fn" | "F13" | è‡ªè¨‚
}

export const DEFAULT_HOTKEY_CONFIG: HotkeyConfig = {
  mode: "push_to_talk",
  triggerKey: "fn",
};

export const HOTKEY_MODE_LABELS: Record<HotkeyMode, { name: string; desc: string }> = {
  push_to_talk: {
    name: "é•·æŒ‰éŒ„éŸ³",
    desc: "æŒ‰ä½ fn éµé–‹å§‹éŒ„éŸ³ï¼Œæ”¾é–‹åœæ­¢",
  },
  toggle: {
    name: "é»æŒ‰åˆ‡æ›",
    desc: "çŸ­æŒ‰ fn éµé–‹å§‹éŒ„éŸ³ï¼Œå†æŒ‰ä¸€æ¬¡åœæ­¢",
  },
};
```

### 4.4 FloatingBar.tsx äº‹ä»¶ç›£è½æ”¹é€ 

```tsx
// FloatingBar.tsx â€” äº‹ä»¶ç›£è½æ”¹é€ ï¼ˆé—œéµå·®ç•°éƒ¨åˆ†ï¼‰

useEffect(() => {
  const listeners: Promise<() => void>[] = [];

  // é•·æŒ‰æ¨¡å¼ï¼šfn æŒ‰ä½ > 300ms â†’ é–‹å§‹éŒ„éŸ³
  listeners.push(
    listen("hotkey-pressed", () => {
      if (stateRef.current === "idle") {
        handleStartRecording();
      }
    })
  );

  // é•·æŒ‰æ¨¡å¼ï¼šfn æ”¾é–‹ â†’ åœæ­¢éŒ„éŸ³
  listeners.push(
    listen("hotkey-released", () => {
      if (stateRef.current === "recording") {
        handleStopRecording();
      }
    })
  );

  // é»æŒ‰æ¨¡å¼ï¼šfn çŸ­æŒ‰ â†’ toggle
  listeners.push(
    listen("hotkey-tap", () => {
      if (stateRef.current === "idle") {
        handleStartRecording();
      } else if (stateRef.current === "recording") {
        handleStopRecording();
      }
    })
  );

  // éŒ„éŸ³å¤ªçŸ­ï¼Œå–æ¶ˆ
  listeners.push(
    listen("hotkey-cancelled", () => {
      if (stateRef.current === "recording") {
        handleCancelRecording();
        // é¡¯ç¤ºçŸ­æš« toast: "éŒ„éŸ³å¤ªçŸ­ï¼Œå·²å–æ¶ˆ"
      }
    })
  );

  return () => {
    listeners.forEach((p) => p.then((f) => f()));
  };
}, [handleStartRecording, handleStopRecording]);
```

### 4.5 Settings.tsx æ–°å¢å€å¡Š

#### 4.5.1 å¿«æ·éµè¨­å®šå€å¡Š

```tsx
{/* å¿«æ·éµè¨­å®š */}
<SettingsSection title="å¿«æ·éµ">
  <div className="setting-row">
    <label>è§¸ç™¼éµ</label>
    <span className="kbd-badge">fn (Globe ğŸŒ)</span>
  </div>
  <div className="setting-row">
    <label>éŒ„éŸ³æ¨¡å¼</label>
    <select
      value={hotkeyMode}
      onChange={(e) => handleSetSetting("hotkey_mode", e.target.value)}
    >
      <option value="push_to_talk">é•·æŒ‰éŒ„éŸ³ â€” æŒ‰ä½ fn éŒ„éŸ³ï¼Œæ”¾é–‹åœæ­¢</option>
      <option value="toggle">é»æŒ‰åˆ‡æ› â€” æŒ‰ä¸€ä¸‹é–‹å§‹ï¼Œå†æŒ‰ä¸€ä¸‹åœæ­¢</option>
    </select>
  </div>
  <div className="setting-hint">
    æç¤ºï¼šè«‹åœ¨ã€Œç³»çµ±è¨­å®š â†’ éµç›¤ â†’ æŒ‰ä¸‹ ğŸŒ éµæ™‚ã€é¸æ“‡ã€Œä¸åšä»»ä½•å‹•ä½œã€ä»¥é¿å…è¡çªã€‚
  </div>
</SettingsSection>
```

#### 4.5.2 æ¬Šé™ç‹€æ…‹å„€è¡¨æ¿

```tsx
{/* æ¬Šé™ç‹€æ…‹ */}
<SettingsSection title="æ¬Šé™ç‹€æ…‹">
  <PermissionRow
    label="éº¥å…‹é¢¨"
    description="èªéŸ³éŒ„è£½æ‰€éœ€"
    granted={perms?.microphone === "authorized"}
    onFix={() => openSystemPreferences("microphone")}
  />
  <PermissionRow
    label="è¼”åŠ©ä½¿ç”¨ (Accessibility)"
    description="æ–‡å­—æ³¨å…¥èˆ‡ä¸Šä¸‹æ–‡è®€å–æ‰€éœ€"
    granted={perms?.accessibility ?? false}
    onFix={() => openSystemPreferences("accessibility")}
  />
  <PermissionRow
    label="è¼¸å…¥ç›£æ§ (Input Monitoring)"
    description="å…¨åŸŸå¿«æ·éµç›£è½æ‰€éœ€"
    granted={perms?.input_monitoring ?? false}
    onFix={() => openSystemPreferences("input_monitoring")}
  />
</SettingsSection>

{/* PermissionRow å…ƒä»¶ */}
function PermissionRow({ label, description, granted, onFix }) {
  return (
    <div className="setting-row permission-row">
      <div>
        <label>{label}</label>
        <span className="setting-description">{description}</span>
      </div>
      <div className="permission-status">
        {granted ? (
          <span className="permission-granted">âœ“ å·²æˆæ¬Š</span>
        ) : (
          <button className="btn btn-ghost btn-sm" onClick={onFix}>
            å‰å¾€è¨­å®š â†’
          </button>
        )}
      </div>
    </div>
  );
}
```

---

## äº”ã€Onboarding æ¬Šé™è«‹æ±‚æµç¨‹ (P0)

### 5.1 æµç¨‹è¨­è¨ˆ

ç¾æœ‰ 4 æ­¥é©Ÿæ”¹ç‚º 6 æ­¥é©Ÿï¼Œæ ¸å¿ƒè®ŠåŒ–åœ¨ Step 3 æ‹†åˆ†ç‚ºä¸‰å€‹ç¨ç«‹æ¬Šé™å¼•å°å­æ­¥é©Ÿï¼š

```
Step 1: Welcome        â†’ æ­¡è¿ç•«é¢ï¼ˆä¸è®Šï¼‰
Step 2: Privacy        â†’ éš±ç§æ‰¿è«¾ï¼ˆä¸è®Šï¼‰
Step 3: Microphone     â†’ éº¥å…‹é¢¨æ¬Šé™ï¼ˆæ–°å¢ï¼Œç³»çµ±å°è©±æ¡†ï¼‰
Step 4: Accessibility  â†’ è¼”åŠ©ä½¿ç”¨æ¬Šé™ï¼ˆæ–°å¢ï¼Œæ‰‹å‹•å¼•å° + è¼ªè©¢ï¼‰
Step 5: Keyboard Setup â†’ fn éµè¨­å®šå¼•å°ï¼ˆæ–°å¢ï¼‰
Step 6: Finish         â†’ å®Œæˆï¼ˆæ”¹é€ ï¼‰
```

### 5.2 åˆ†å±¤æ¬Šé™ç­–ç•¥ï¼ˆå°æ‡‰ç ”ç©¶å ±å‘Š #3ï¼‰

| Layer | æ¬Šé™ | è«‹æ±‚æ™‚æ©Ÿ | æ–¹å¼ |
| ----- | ---- | -------- | ---- |
| Layer 1 å¿…è¦ | éº¥å…‹é¢¨ | Onboarding Step 3 | ç³»çµ±å°è©±æ¡† (AVCaptureDevice.requestAccess) |
| Layer 1 å¿…è¦ | Accessibility | Onboarding Step 4 | å¼•å°åˆ°ç³»çµ±è¨­å®š + æ¯ 2 ç§’è¼ªè©¢ |
| Layer 2 åŠŸèƒ½è§¸ç™¼ | Input Monitoring | é¦–æ¬¡ä½¿ç”¨ fn éµæ™‚ | è‡ªå‹•éš¨ Accessibility ç²å¾—ï¼Œæˆ–å¼•å°é–‹å•Ÿ |
| Layer 3 å¯é¸ | é€šçŸ¥ | é¦–æ¬¡å®Œæˆè½‰éŒ„å¾Œ | UNUserNotificationCenter.requestAuthorization |
| Layer 3 å¯é¸ | è‡ªå‹•å•Ÿå‹• | è¨­å®šé é¢ | ç”¨æˆ¶è‡ªè¡Œé–‹å•Ÿ |

### 5.3 Pre-Permission Pattern å¯¦ä½œ

æ¯å€‹æ¬Šé™æ­¥é©Ÿéµå¾ªã€Œå…ˆè§£é‡‹ â†’ å†è«‹æ±‚ã€æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚   [åœ–ç¤º/å‹•ç•«]                        â”‚
â”‚                                     â”‚
â”‚   ç‚ºä»€éº¼éœ€è¦é€™å€‹æ¬Šé™ï¼Ÿ               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚   EchoType éœ€è¦å­˜å–éº¥å…‹é¢¨            â”‚
â”‚   æ‰èƒ½å°‡æ‚¨çš„èªéŸ³è½‰æ›ç‚ºæ–‡å­—ã€‚         â”‚
â”‚   æ‰€æœ‰èªéŸ³è³‡æ–™åƒ…åœ¨æœ¬æ©Ÿè™•ç†ï¼Œ         â”‚
â”‚   çµ•ä¸ä¸Šå‚³è‡³ä»»ä½•ä¼ºæœå™¨ã€‚             â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  æˆæ¬Šä¸¦ç¹¼çºŒ  â”‚  â”‚ ç¨å¾Œå†èªª â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 å„æ­¥é©Ÿè©³ç´°è¨­è¨ˆ

#### Step 3: éº¥å…‹é¢¨æ¬Šé™

```tsx
function OnboardingMicrophone({ onNext, onSkip }) {
  const [micStatus, setMicStatus] = useState<string>("not_determined");
  const [requesting, setRequesting] = useState(false);

  const handleRequest = async () => {
    setRequesting(true);
    try {
      const result = await requestMicrophone();
      setMicStatus(result);
      if (result === "authorized") {
        setTimeout(onNext, 800);
      }
    } finally {
      setRequesting(false);
    }
  };

  return (
    <div className="onboarding-step">
      <div className="onboarding-icon">ğŸ™ï¸</div>
      <h2>éº¥å…‹é¢¨æ¬Šé™</h2>
      <p className="onboarding-desc">
        EchoType éœ€è¦å­˜å–éº¥å…‹é¢¨æ‰èƒ½å°‡æ‚¨çš„èªéŸ³è½‰æ›ç‚ºæ–‡å­—ã€‚
        <br />
        <strong>æ‰€æœ‰èªéŸ³è³‡æ–™åƒ…åœ¨æœ¬æ©Ÿè™•ç†ï¼Œçµ•ä¸ä¸Šå‚³ã€‚</strong>
      </p>

      {micStatus === "authorized" ? (
        <div className="permission-success">
          <span className="check-icon">âœ“</span> éº¥å…‹é¢¨å·²æˆæ¬Š
        </div>
      ) : micStatus === "denied" ? (
        <div className="permission-denied">
          <p>éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•ï¼Œè«‹æ‰‹å‹•é–‹å•Ÿï¼š</p>
          <button
            className="btn btn-primary"
            onClick={() => openSystemPreferences("microphone")}
          >
            æ‰“é–‹ç³»çµ±è¨­å®š
          </button>
          <button className="btn btn-ghost" onClick={onSkip}>
            ç¨å¾Œå†èªª
          </button>
        </div>
      ) : (
        <div className="onboarding-actions">
          <button
            className="btn btn-primary"
            onClick={handleRequest}
            disabled={requesting}
          >
            {requesting ? "è«‹æ±‚ä¸­â€¦" : "æˆæ¬Šéº¥å…‹é¢¨"}
          </button>
          <button className="btn btn-ghost" onClick={onSkip}>
            ç¨å¾Œå†èªª
          </button>
        </div>
      )}
    </div>
  );
}
```

#### Step 4: Accessibility æ¬Šé™ï¼ˆè¼ªè©¢æ¨¡å¼ï¼‰

é€™æ˜¯æœ€é—œéµçš„æ­¥é©Ÿ â€” Accessibility ç„¡æ³•ç”±ç¨‹å¼ç¢¼è§¸ç™¼ç³»çµ±å°è©±æ¡†ï¼Œå¿…é ˆå¼•å°ç”¨æˆ¶æ‰‹å‹•é–‹å•Ÿã€‚

```tsx
function OnboardingAccessibility({ onNext, onSkip }) {
  const [granted, setGranted] = useState(false);
  const [opened, setOpened] = useState(false);

  // æ¯ 2 ç§’è¼ªè©¢ Accessibility æ¬Šé™ç‹€æ…‹
  useEffect(() => {
    const cleanup = pollPermission(
      async () => {
        const perms = await checkAllPermissions();
        return perms.accessibility;
      },
      () => {
        setGranted(true);
        setTimeout(onNext, 1000);
      },
      2000
    );
    return cleanup;
  }, [onNext]);

  const handleOpenSettings = async () => {
    await openSystemPreferences("accessibility");
    setOpened(true);
  };

  return (
    <div className="onboarding-step">
      <div className="onboarding-icon">âŒ¨ï¸</div>
      <h2>è¼”åŠ©ä½¿ç”¨æ¬Šé™</h2>
      <p className="onboarding-desc">
        EchoType éœ€è¦ã€Œè¼”åŠ©ä½¿ç”¨ã€æ¬Šé™æ‰èƒ½å°‡è½‰éŒ„æ–‡å­—è‡ªå‹•è¼¸å…¥åˆ°æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼ä¸­ã€‚
      </p>

      {granted ? (
        <div className="permission-success">
          <span className="check-icon">âœ“</span> è¼”åŠ©ä½¿ç”¨å·²æˆæ¬Š
        </div>
      ) : (
        <>
          {/* åœ–æ–‡æ•™å­¸ */}
          <div className="permission-guide">
            <div className="guide-step">
              <span className="guide-number">1</span>
              <span>é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ‰“é–‹ç³»çµ±è¨­å®š</span>
            </div>
            <div className="guide-step">
              <span className="guide-number">2</span>
              <span>åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ° EchoType</span>
            </div>
            <div className="guide-step">
              <span className="guide-number">3</span>
              <span>é–‹å•Ÿ EchoType æ—é‚Šçš„é–‹é—œ</span>
            </div>
          </div>

          <div className="onboarding-actions">
            <button className="btn btn-primary" onClick={handleOpenSettings}>
              {opened ? "é‡æ–°æ‰“é–‹ç³»çµ±è¨­å®š" : "æ‰“é–‹ç³»çµ±è¨­å®š"}
            </button>
            <button className="btn btn-ghost" onClick={onSkip}>
              ç¨å¾Œå†èªª
            </button>
          </div>

          {opened && (
            <p className="permission-waiting">
              <span className="spinner-sm" /> ç­‰å¾…æˆæ¬Šä¸­â€¦é–‹å•Ÿå¾Œå°‡è‡ªå‹•ç¹¼çºŒ
            </p>
          )}
        </>
      )}
    </div>
  );
}
```

#### Step 5: fn éµè¨­å®šå¼•å°ï¼ˆæ–°å¢ï¼‰

```tsx
function OnboardingKeyboardSetup({ onNext }) {
  return (
    <div className="onboarding-step">
      <div className="onboarding-icon">ğŸŒ</div>
      <h2>è¨­å®š fn éµ</h2>
      <p className="onboarding-desc">
        EchoType ä½¿ç”¨ fn (Globe ğŸŒ) éµä½œç‚ºéŒ„éŸ³è§¸ç™¼éµã€‚
        ç‚ºé¿å…èˆ‡ç³»çµ±åŠŸèƒ½è¡çªï¼Œå»ºè­°é€²è¡Œä»¥ä¸‹è¨­å®šï¼š
      </p>

      <div className="permission-guide">
        <div className="guide-step">
          <span className="guide-number">1</span>
          <span>æ‰“é–‹ã€Œç³»çµ±è¨­å®š â†’ éµç›¤ã€</span>
        </div>
        <div className="guide-step">
          <span className="guide-number">2</span>
          <span>æ‰¾åˆ°ã€ŒæŒ‰ä¸‹ ğŸŒ éµæ™‚ã€</span>
        </div>
        <div className="guide-step">
          <span className="guide-number">3</span>
          <span>é¸æ“‡ã€Œä¸åšä»»ä½•å‹•ä½œã€</span>
        </div>
      </div>

      <div className="hotkey-preview">
        <div className="hotkey-mode">
          <strong>é•·æŒ‰ fn</strong> â†’ æŒ‰ä½éŒ„éŸ³ï¼Œæ”¾é–‹åœæ­¢
        </div>
        <div className="hotkey-mode">
          <strong>çŸ­æŒ‰ fn</strong> â†’ é»ä¸€ä¸‹é–‹å§‹ï¼Œå†é»ä¸€ä¸‹åœæ­¢
        </div>
      </div>

      <div className="onboarding-actions">
        <button className="btn btn-primary" onClick={onNext}>
          æˆ‘çŸ¥é“äº†ï¼Œç¹¼çºŒ
        </button>
      </div>
    </div>
  );
}
```

#### Step 6: å®Œæˆï¼ˆæ”¹é€ ï¼‰

```tsx
function OnboardingFinish({ onComplete }) {
  const [perms, setPerms] = useState<PermissionStatus | null>(null);

  useEffect(() => {
    checkAllPermissions().then(setPerms);
  }, []);

  return (
    <div className="onboarding-step">
      <div className="onboarding-icon">ğŸ‰</div>
      <h2>è¨­å®šå®Œæˆï¼</h2>

      {/* æ¬Šé™æ‘˜è¦ */}
      <div className="permission-summary">
        <SummaryRow label="éº¥å…‹é¢¨" ok={perms?.microphone === "authorized"} />
        <SummaryRow label="è¼”åŠ©ä½¿ç”¨" ok={perms?.accessibility ?? false} />
        <SummaryRow label="è¼¸å…¥ç›£æ§" ok={perms?.input_monitoring ?? false} />
      </div>

      {/* ç¼ºå°‘æ¬Šé™çš„è­¦å‘Š */}
      {perms && (!perms.accessibility || perms.microphone !== "authorized") && (
        <p className="onboarding-warning">
          éƒ¨åˆ†æ¬Šé™å°šæœªæˆæ¬Šï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ç„¡æ³•æ­£å¸¸é‹ä½œã€‚
          æ‚¨å¯ä»¥ç¨å¾Œåœ¨ã€Œè¨­å®š â†’ æ¬Šé™ç‹€æ…‹ã€ä¸­é–‹å•Ÿã€‚
        </p>
      )}

      <div className="onboarding-actions">
        <button className="btn btn-primary" onClick={onComplete}>
          é–‹å§‹ä½¿ç”¨ EchoType
        </button>
      </div>
    </div>
  );
}
```

### 5.5 Onboarding ä¸»å…ƒä»¶æ”¹é€ 

```tsx
// Onboarding.tsx ä¸»çµæ§‹

const TOTAL_STEPS = 6;

export default function Onboarding() {
  const [step, setStep] = useState(0);
  const navigate = useNavigate();

  const handleComplete = async () => {
    await invoke("set_setting", { key: "onboarding_completed", value: "true" });
    navigate("/");
  };

  const handleSkip = () => setStep((s) => s + 1);
  const handleNext = () => setStep((s) => s + 1);

  return (
    <div className="onboarding-container">
      {/* é€²åº¦æ¢ */}
      <div className="onboarding-progress">
        <div
          className="onboarding-progress-bar"
          style={{ width: `${((step + 1) / TOTAL_STEPS) * 100}%` }}
        />
      </div>

      <AnimatePresence mode="wait">
        <motion.div
          key={step}
          initial={{ opacity: 0, x: 20 }}
          animate={{ opacity: 1, x: 0 }}
          exit={{ opacity: 0, x: -20 }}
          transition={{ duration: 0.25 }}
        >
          {step === 0 && <OnboardingWelcome onNext={handleNext} />}
          {step === 1 && <OnboardingPrivacy onNext={handleNext} />}
          {step === 2 && <OnboardingMicrophone onNext={handleNext} onSkip={handleSkip} />}
          {step === 3 && <OnboardingAccessibility onNext={handleNext} onSkip={handleSkip} />}
          {step === 4 && <OnboardingKeyboardSetup onNext={handleNext} />}
          {step === 5 && <OnboardingFinish onComplete={handleComplete} />}
        </motion.div>
      </AnimatePresence>
    </div>
  );
}
```

### 5.6 é™ç´šç­–ç•¥

| æ¬Šé™ | è¢«æ‹’/æœªé–‹å•Ÿæ™‚çš„é™ç´šæ–¹æ¡ˆ |
| ---- | ---------------------- |
| éº¥å…‹é¢¨ | å®Œå…¨ç„¡æ³•èªéŸ³ï¼Œé¡¯ç¤ºæ˜ç¢ºå¼•å°åˆ°ç³»çµ±è¨­å®š |
| Accessibility | å¯è½‰éŒ„ä½†ç„¡æ³•è‡ªå‹•è¼¸å…¥ï¼Œæä¾›ã€Œè¤‡è£½åˆ°å‰ªè²¼ç°¿ã€æ›¿ä»£ |
| Input Monitoring | ç„¡æ³•å…¨åŸŸå¿«æ·éµï¼Œæ”¹ç”¨ Menu Bar æŒ‰éˆ•æˆ–æ‡‰ç”¨å…§æŒ‰éˆ•è§¸ç™¼ |
| é€šçŸ¥ | éœé»˜æ¨¡å¼ï¼Œä¸å½±éŸ¿æ ¸å¿ƒåŠŸèƒ½ |

---

## å…­ã€Swift Helper è®Šæ›´

### 6.1 æ–°å¢ Commands

helper/main.swift éœ€æ–°å¢ä»¥ä¸‹å‘½ä»¤æ”¯æ´å‰ç«¯æ¬Šé™æµç¨‹ï¼š

```swift
// helper/main.swift â€” æ–°å¢å‘½ä»¤

case "check_microphone_permission":
    let status = AVCaptureDevice.authorizationStatus(for: .audio)
    let statusStr: String
    switch status {
    case .notDetermined: statusStr = "not_determined"
    case .authorized:    statusStr = "authorized"
    case .denied:        statusStr = "denied"
    case .restricted:    statusStr = "restricted"
    @unknown default:    statusStr = "unknown"
    }
    respond(result: .string(statusStr))

case "request_microphone":
    AVCaptureDevice.requestAccess(for: .audio) { granted in
        let status = granted ? "authorized" : "denied"
        respond(result: .string(status))
    }

case "check_accessibility":
    let trusted = AXIsProcessTrusted()
    respond(result: .bool(trusted))
```

### 6.2 CoreKit æ–°å¢ PermissionManager

```swift
// CoreKit/Sources/CoreKit/Permissions/PermissionManager.swift

import AVFoundation
import AppKit

public actor PermissionManager {
    public static let shared = PermissionManager()

    // === éº¥å…‹é¢¨ ===
    public func checkMicrophoneStatus() -> String {
        let status = AVCaptureDevice.authorizationStatus(for: .audio)
        switch status {
        case .notDetermined: return "not_determined"
        case .authorized:    return "authorized"
        case .denied:        return "denied"
        case .restricted:    return "restricted"
        @unknown default:    return "unknown"
        }
    }

    public func requestMicrophone() async -> Bool {
        await AVCaptureDevice.requestAccess(for: .audio)
    }

    // === Accessibility ===
    public func checkAccessibility() -> Bool {
        AXIsProcessTrusted()
    }

    // === ç³»çµ±è¨­å®š Deep Links ===
    public func openSystemPreferences(pane: String) {
        let urlMap: [String: String] = [
            "microphone":
                "x-apple.systempreferences:com.apple.preference.security?Privacy_Microphone",
            "accessibility":
                "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility",
            "input_monitoring":
                "x-apple.systempreferences:com.apple.preference.security?Privacy_ListenEvent",
        ]
        guard let urlStr = urlMap[pane],
              let url = URL(string: urlStr) else { return }
        NSWorkspace.shared.open(url)
    }
}
```

---

## ä¸ƒã€Onboarding CSS æ¨£å¼

```css
/* æ–°å¢è‡³ index.css æˆ–ç¨ç«‹ Onboarding.css */

/* === æ¬Šé™å¼•å°æ­¥é©Ÿ === */
.permission-guide {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 24px 0;
  padding: 20px;
  background: var(--color-surface);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.guide-step {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
  color: var(--color-text);
}

.guide-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--gradient-accent);
  color: white;
  font-size: 12px;
  font-weight: 600;
  flex-shrink: 0;
}

/* === æ¬Šé™ç‹€æ…‹æŒ‡ç¤º === */
.permission-success {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 16px 20px;
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
  border-radius: var(--radius-md);
  color: var(--color-success);
  font-weight: 500;
}

.permission-denied {
  text-align: center;
}

.permission-waiting {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 16px;
  color: var(--color-text-muted);
  font-size: 13px;
}

.spinner-sm {
  width: 14px;
  height: 14px;
  border: 2px solid rgba(255,255,255,0.1);
  border-top-color: var(--color-accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* === æ¬Šé™æ‘˜è¦ï¼ˆå®Œæˆé é¢ï¼‰ === */
.permission-summary {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 20px 0;
  padding: 16px;
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
}

.summary-row .status-ok {
  color: var(--color-success);
}

.summary-row .status-missing {
  color: var(--color-text-muted);
}

.onboarding-warning {
  padding: 12px 16px;
  background: rgba(234, 179, 8, 0.1);
  border: 1px solid rgba(234, 179, 8, 0.3);
  border-radius: var(--radius-md);
  color: #eab308;
  font-size: 13px;
  text-align: center;
}

/* === å¿«æ·éµé è¦½ === */
.hotkey-preview {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 20px 0;
  padding: 16px;
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.hotkey-mode {
  font-size: 14px;
  color: var(--color-text);
}

/* === Settings æ¬Šé™è¡Œ === */
.permission-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.permission-granted {
  color: var(--color-success);
  font-size: 13px;
  font-weight: 500;
}

.setting-description {
  display: block;
  font-size: 12px;
  color: var(--color-text-muted);
  margin-top: 2px;
}

.setting-hint {
  padding: 12px 16px;
  background: var(--color-surface);
  border-radius: var(--radius-sm);
  font-size: 12px;
  color: var(--color-text-muted);
  margin-top: 8px;
}

.kbd-badge {
  display: inline-block;
  padding: 4px 10px;
  background: var(--color-surface-2);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: monospace;
  font-size: 13px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
```

---

## å…«ã€å®Œæ•´æª”æ¡ˆè®Šæ›´æ¸…å–®

### 8.1 æ–°å¢æª”æ¡ˆ

| æª”æ¡ˆè·¯å¾‘ | ç”¨é€” |
| -------- | ---- |
| `desktop/src-tauri/src/permissions.rs` | Rust æ¬Šé™ç®¡ç†æ¨¡çµ„ |
| `desktop/src/lib/permissions.ts` | å‰ç«¯æ¬Šé™ API + React Hook |
| `desktop/src/lib/hotkey-config.ts` | å¿«æ·éµé…ç½®å‹åˆ¥èˆ‡å¸¸æ•¸ |
| `CoreKit/Sources/CoreKit/Permissions/PermissionManager.swift` | Swift æ¬Šé™ç®¡ç† Actor |

### 8.2 ä¿®æ”¹æª”æ¡ˆ

| æª”æ¡ˆè·¯å¾‘ | è®Šæ›´å…§å®¹ |
| -------- | -------- |
| `desktop/src-tauri/src/keyboard.rs` | å®Œå…¨æ”¹å¯«ï¼šç§»é™¤ global-shortcutï¼Œæ”¹ç”¨ CGEventTap fn ç‹€æ…‹æ©Ÿ |
| `desktop/src-tauri/src/lib.rs` | ç§»é™¤ global-shortcut pluginï¼Œæ–°å¢ permissions modï¼Œè¨»å†Šæ–° commands |
| `desktop/src-tauri/src/commands.rs` | æ–°å¢ check_permissionsã€open_system_preferencesã€request_microphone |
| `desktop/src-tauri/Cargo.toml` | ç§»é™¤ tauri-plugin-global-shortcutï¼Œæ–°å¢ core-graphicsã€core-foundation |
| `desktop/src/components/Settings.tsx` | ä¿®å¾©æ»¾å‹•æº¢å‡ºï¼Œæ–°å¢å¿«æ·éµå€å¡Šã€æ¬Šé™ç‹€æ…‹å„€è¡¨æ¿ |
| `desktop/src/components/Onboarding.tsx` | 4 æ­¥é©Ÿ â†’ 6 æ­¥é©Ÿï¼Œå¯¦ä½œæ¬Šé™è«‹æ±‚æµç¨‹ |
| `desktop/src/components/FloatingBar.tsx` | æ–°å¢ hotkey-tapã€hotkey-cancelled äº‹ä»¶ç›£è½ |
| `desktop/src/index.css` | æ–°å¢ settings æ»¾å‹•ã€æ¬Šé™å¼•å°ã€onboarding ç›¸é—œæ¨£å¼ |
| `desktop/package.json` | ç§»é™¤ @tauri-apps/plugin-global-shortcut |
| `helper/main.swift` | æ–°å¢ check_microphone_permissionã€request_microphone å‘½ä»¤ |

### 8.3 ç§»é™¤ä¾è³´

| ä¾è³´ | åŸå›  |
| ---- | ---- |
| `tauri-plugin-global-shortcut` (Rust) | æ”¹ç”¨ CGEventTap ç›´æ¥ç›£è½ fn éµ |
| `@tauri-apps/plugin-global-shortcut` (npm) | åŒä¸Š |

---

## ä¹ã€å¯¦ä½œé †åºèˆ‡ä¾è³´é—œä¿‚

```
Phase 1: åŸºç¤è¨­æ–½ï¼ˆç„¡ UI ä¾è³´ï¼‰
â”œâ”€â”€ 1a. permissions.rs â€” Rust æ¬Šé™æª¢æ¸¬æ¨¡çµ„
â”œâ”€â”€ 1b. PermissionManager.swift â€” Swift æ¬Šé™ç®¡ç†
â”œâ”€â”€ 1c. helper/main.swift â€” æ–°å¢æ¬Šé™å‘½ä»¤
â””â”€â”€ 1d. lib/permissions.ts â€” å‰ç«¯æ¬Šé™ API

Phase 2: CGEventTap éµç›¤æ”¹é€ ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ 2a. keyboard.rs â€” å®Œå…¨æ”¹å¯«ç‚º CGEventTap fn ç‹€æ…‹æ©Ÿ
â”œâ”€â”€ 2b. lib.rs â€” ç§»é™¤ global-shortcutï¼Œæ•´åˆæ–° keyboard
â”œâ”€â”€ 2c. Cargo.toml â€” ä¾è³´è®Šæ›´
â””â”€â”€ 2d. FloatingBar.tsx â€” æ–°å¢äº‹ä»¶ç›£è½

Phase 3: å‰ç«¯ UIï¼ˆä¾è³´ Phase 1ï¼‰
â”œâ”€â”€ 3a. Settings.tsx â€” æ»¾å‹•ä¿®å¾© + æ–°å€å¡Š
â”œâ”€â”€ 3b. index.css â€” æ–°å¢æ¨£å¼
â””â”€â”€ 3c. Onboarding.tsx â€” 6 æ­¥é©Ÿæ¬Šé™æµç¨‹

Phase 4: æ•´åˆæ¸¬è©¦
â”œâ”€â”€ 4a. æ¬Šé™æµç¨‹ç«¯åˆ°ç«¯æ¸¬è©¦
â”œâ”€â”€ 4b. fn éµé•·æŒ‰/é»æŒ‰æ¸¬è©¦
â”œâ”€â”€ 4c. è¨­å®šé é¢æ»¾å‹•æ¸¬è©¦
â””â”€â”€ 4d. Onboarding å®Œæ•´æµç¨‹æ¸¬è©¦
```

å»ºè­°å¯¦ä½œé †åºï¼š1a â†’ 1b â†’ 1c â†’ 1d â†’ 2a â†’ 2b â†’ 2c â†’ 2d â†’ 3a â†’ 3b â†’ 3c â†’ 4*

---

## åã€å·²çŸ¥é¢¨éšªèˆ‡ç·©è§£

| é¢¨éšª | å½±éŸ¿ | ç·©è§£æ–¹æ¡ˆ |
| ---- | ---- | -------- |
| fn éµè¢«ç³»çµ±æ””æˆªï¼ˆè½å¯«/Emojiï¼‰ | CGEventTap æ”¶ä¸åˆ°å®Œæ•´äº‹ä»¶ | Onboarding å¼•å°ç”¨æˆ¶è¨­å®šã€Œä¸åšä»»ä½•å‹•ä½œã€ |
| CGEventTap è¢«ç³»çµ±åœç”¨ | å¿«æ·éµå¤±æ•ˆ | callback ä¸­åµæ¸¬ kCGEventTapDisabledByTimeout ä¸¦è‡ªå‹• re-enable |
| Accessibility æ¬Šé™è¢«æ’¤éŠ· | æ–‡å­—æ³¨å…¥å¤±æ•— | æ¯ 2 ç§’è¼ªè©¢ï¼Œç‹€æ…‹è®ŠåŒ–æ™‚é€šçŸ¥å‰ç«¯ |
| macOS Sequoia æ¯é€±æ¬Šé™æé†’ | ç”¨æˆ¶å¯èƒ½æ’¤éŠ·æˆæ¬Š | æ‡‰ç”¨å…§æ¸…æ¥šèªªæ˜æ¬Šé™ç”¨é€” |
| App Sandbox é™åˆ¶ | CGEventTap ç„¡æ³•ä½¿ç”¨ | ä½¿ç”¨ Developer ID ç°½å + å…¬è­‰ç›´æ¥åˆ†ç™¼ï¼Œä¸ä¸Š App Store |
| core-graphics crate å°è£ä¸å®Œæ•´ | CGEventTap API ç¼ºå¤± | æ‰‹å‹• FFI å®£å‘Šï¼ˆå·²åœ¨ 3.2.3 æä¾›å®Œæ•´å¯¦ä½œï¼‰ |

---

## åä¸€ã€èˆ‡ Typeless çš„å·®ç•°åŒ–å®šä½

| ç¶­åº¦ | Typeless | EchoType v0.3.0 |
| ---- | -------- | --------------- |
| æ¡†æ¶ | Electron (~200MB) | Tauri v2 (~15MB) |
| ASR | é›²ç«¯ (OpenAI) | æœ¬åœ° (Whisper/Qwen3) |
| éš±ç§ | é›²ç«¯è™•ç† + é›¶ä¿ç•™ | å®Œå…¨é›¢ç·šï¼Œè³‡æ–™ä¸é›¢é–‹è£ç½® |
| å¿«æ·éµ | fn éµ (Electron + koffi + Swift dylib) | fn éµ (Rust CGEventTap ç›´æ¥) |
| é•·æŒ‰/é»æŒ‰ | é€é Swift dylib å¯¦ä½œ | Rust åŸç”Ÿç‹€æ…‹æ©Ÿ |
| æ¬Šé™å¼•å° | Electron å…§å»º + child-process | Tauri command + Swift helper |
| æ–‡å­—æ³¨å…¥ | Swift dylib via koffi FFI | Swift helper via JSON IPC |
| å»¶é² | å¤šå±¤ FFI é–‹éŠ· | Rust ç›´æ¥ CGEventTapï¼Œæœ€ä½å»¶é² |

EchoType çš„æ ¸å¿ƒå„ªå‹¢ï¼šæ›´å°çš„é«”ç©ã€å®Œå…¨é›¢ç·šéš±ç§ã€æ›´ä½çš„ç³»çµ±è³‡æºä½”ç”¨ã€Rust åŸç”Ÿæ•ˆèƒ½ã€‚
